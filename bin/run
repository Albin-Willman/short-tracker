#!/usr/bin/env ruby

require 'json'
require 'date'
require_relative "../ruby/downloader.rb"
require_relative "../ruby/parser.rb"

date = Date.today.to_s
file_name = 'tmp/data.xls'
data_path = Downloader.new.run(file_name, date)

data = XlsParser.new.run(data_path)

file_path ||= File.join(File.dirname(__FILE__), "../dist/api/data.json")
File.open(file_path,"w") do |f|
  f.write({
    companies: data,
    updated: date
  }.to_json)
end
